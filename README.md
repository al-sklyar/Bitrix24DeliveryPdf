# Bitrix24DeliveryPdf

Это боевой PHP-модуль, предназначенный для автоматической генерации PDF-документов с маршрутами курьеров, сформированными на основе заказов из смарт-процесса Bitrix24.

Разработка модуля велась оперативно для обеспечения своевременной работы к праздничному периоду (8 марта). Проект был реализован для облачного Bitrix24, при этом основной сайт заказчика был создан на WordPress. По этой причине было принято осмысленное решение реализовать функционал компактно, разместив всю логику взаимодействия с геокодером Яндекса, сервисом OSRM и API Bitrix24 всего в двух файлах, что позволило быстро и эффективно интегрировать решение в существующую инфраструктуру.

Модуль успешно эксплуатируется более трёх месяцев.

## Основные возможности

* **Получение заказов** из смарт-процесса Bitrix24 по фильтру (например, по стадии «Курьер назначен»);
* **Группировка заказов** по назначенным курьерам;
* **Геокодирование адресов** через API Яндекс.Геокодера;
* **Построение оптимального маршрута** с использованием сервиса OSRM;
* **Генерация PDF-документов** с помощью Document Generator Bitrix24;
* Предоставление ссылок для скачивания готовых PDF-файлов.

## Как использовать

Для запуска модуля необходимо:

1. Создать локальное приложение в Bitrix24, указав URL-адрес размещения исполняемого файла (`button.php`).
2. Настроить webhook Bitrix24, ссылка на который указывается в константах.
3. Подготовить соответствующие смарт-процессы в Bitrix24 (процесс «Доставка», процесс «Генерируем PDF»), указать их ID и необходимые поля.
4. Создать шаблон PDF-документа в Document Generator Bitrix24, указав нужные поля для подстановки.
5. Разместить файлы `handler.php` и `button.php` на своём сайте в отдельной папке и настроить доступ.

После этого можно запускать генерацию:

* Открыть страницу с файлом `button.php` и нажать на кнопку «Запустить».
* Результат работы (логи и ссылки на скачивание PDF) появится непосредственно на этой же странице.

## Структура файлов

* `handler.php` — основной логический файл, реализующий взаимодействие с API Bitrix24, геокодером и OSRM.
* `button.php` — исполняемый файл с простым интерфейсом запуска и отображения результата.

**Важно:** Перед использованием обязательно замените все константы (webhook, ID процессов и полей) на ваши собственные значения.
